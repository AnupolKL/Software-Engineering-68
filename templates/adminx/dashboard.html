{% extends "base.html" %}
{% block title %}แดชบอร์ด | CUTCAMP{% endblock %}

{% block content %}
<section class="max-w-7xl mx-auto p-6">

  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-3xl font-extrabold text-white">แดชบอร์ดการจัดการ</h1>
      <p class="text-sm text-gray-500">ภาพรวมสถิติและคิวล่าสุดของร้าน</p>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
    <aside class="hidden lg:block">
      <nav class="bg-white border rounded-2xl overflow-hidden shadow-sm">
        <div class="px-4 py-3 text-sm font-semibold text-gray-700 border-b bg-gray-50">เมนูจัดการ</div>

        {% url 'admin_booking_list' as url_booking_list %}
        {% url 'admin_booking_walkin' as url_booking_walkin %}
        {% url 'admin_barber_list' as url_barber_list %}
        {% url 'admin_service_list' as url_service_list %}

        <div class="flex flex-col text-sm">
          <a href="{{ url_booking_list }}" class="px-4 py-3 hover:bg-gray-50 flex items-center gap-3 {% if request.path == url_booking_list %}bg-emerald-50 font-semibold text-emerald-700{% endif %}">
            <span class="w-2 h-2 rounded-full {% if request.path == url_booking_list %}bg-emerald-600{% else %}bg-gray-300{% endif %}"></span>
            จัดการคิวทั้งหมด
          </a>
          <a href="{{ url_booking_walkin }}" class="px-4 py-3 hover:bg-gray-50 flex items-center gap-3 {% if request.path == url_booking_walkin %}bg-emerald-50 font-semibold text-emerald-700{% endif %}">
            <span class="w-2 h-2 rounded-full {% if request.path == url_booking_walkin %}bg-emerald-600{% else %}bg-gray-300{% endif %}"></span>
            เพิ่มคิว Walk-in
          </a>
          <a href="{{ url_barber_list }}" class="px-4 py-3 hover:bg-gray-50 flex items-center gap-3 {% if request.path == url_barber_list %}bg-emerald-50 font-semibold text-emerald-700{% endif %}">
            <span class="w-2 h-2 rounded-full {% if request.path == url_barber_list %}bg-emerald-600{% else %}bg-gray-300{% endif %}"></span>
            จัดการช่าง
          </a>
          <a href="{{ url_service_list }}" class="px-4 py-3 hover:bg-gray-50 flex items-center gap-3 {% if request.path == url_service_list %}bg-emerald-50 font-semibold text-emerald-700{% endif %}">
            <span class="w-2 h-2 rounded-full {% if request.path == url_service_list %}bg-emerald-600{% else %}bg-gray-300{% endif %}"></span>
            จัดการบริการ
          </a>
        </div>
      </nav>
    </aside>

    <main class="lg:col-span-3">
      <div class="grid sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-4">
        <div class="bg-gradient-to-r from-emerald-400 to-emerald-600 text-white rounded-xl p-4 shadow">
          <div class="text-xs">คิววันนี้</div>
          <div class="text-2xl font-bold">{{ stats.bookings_today }}</div>
        </div>
        <div class="bg-gradient-to-r from-emerald-400 to-emerald-600 text-white rounded-xl p-4 shadow">
          <div class="text-xs">Walk-in วันนี้</div>
          <div class="text-2xl font-bold">{{ stats.walkins_today }}</div>
        </div>
        <div class="bg-gradient-to-r from-emerald-400 to-emerald-600 text-white rounded-xl p-4 shadow">
          <div class="text-xs text-white">บริการที่เปิดอยู่</div>
          <div class="text-2xl font-bold">{{ stats.services_active }}</div>
        </div>
        <div class="bg-gradient-to-r from-emerald-400 to-emerald-600 text-white rounded-xl p-4 shadow">
          <div class="text-xs text-white">ช่าง</div>
          <div class="text-2xl font-bold">{{ stats.barbers }}</div>
        </div>
      </div>

      <div class="grid sm:grid-cols-3 gap-4 mb-6">
        <div class="bg-gradient-to-r from-emerald-400 to-emerald-600 text-white rounded-xl p-4 shadow">
          <div class="text-sm text-white">คิวทั้งหมด</div>
          <div class="text-xl font-semibold">{{ stats.bookings_total }}</div>
        </div>
        <div class="bg-gradient-to-r from-emerald-400 to-emerald-600 text-white rounded-xl p-4 shadow">
          <div class="text-sm text-white">คิวที่ยกเลิก</div>
          <div class="text-xl font-semibold text-red-600">{{ stats.bookings_canceled }}</div>
        </div>
        <div class="bg-gradient-to-r from-emerald-400 to-emerald-600 text-white rounded-xl p-4 shadow">
          <div class="text-sm text-white">คิวที่สำเร็จ</div>
          <div class="text-xl font-semibold text-emerald-100">{{ stats.bookings_completed }}</div>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-lg font-semibold">คิวล่าสุด</h2>
          <a href="{{ url_booking_list }}" class="text-sm text-emerald-600 hover:underline">ดูทั้งหมด</a>
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">เริ่ม</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">บริการ</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">ช่าง</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">ลูกค้า</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">ชนิด</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-100">
              {% for b in latest %}
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 text-sm text-gray-700 whitespace-nowrap">{{ b.start_at|date:"Y-m-d H:i" }}</td>
                <td class="px-4 py-3 text-sm text-gray-700">{{ b.service.name }}</td>
                <td class="px-4 py-3 text-sm text-gray-700">{{ b.barber.username }}</td>
                <td class="px-4 py-3 text-sm text-gray-700">{{ b.customer.username|default:"Walk-in" }}</td>
                <td class="px-4 py-3 text-sm">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">{{ b.get_source_display }}</span>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td class="px-4 py-6 text-center text-sm text-gray-500" colspan="5">ยังไม่มีคิว</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

    </main>
  </div>

</section>
{% endblock %}
